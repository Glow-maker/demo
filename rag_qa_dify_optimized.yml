app:
  description: ä¼˜åŒ–åçš„RAGå¢å¼ºæ£€ç´¢QAè’¸é¦å·¥ä½œæµ - ä¿®å¤source_chunkä½¿ç”¨ã€æ·»åŠ è´¨é‡æ§åˆ¶ã€æ”¹è¿›é”™è¯¯å¤„ç†
  icon: ğŸ¤–
  icon_background: '#FFEAD5'
  mode: workflow
  name: rag_qa_optimized
  use_icon_as_answer_icon: false
dependencies:
- current_identifier: null
  type: marketplace
  value:
    marketplace_plugin_unique_identifier: langgenius/siliconflow:0.0.34@1c203017d8ef49fd9152696a42e6dc71ecf272b115d8caf731c99ee0d2956dce
    version: null
- current_identifier: null
  type: marketplace
  value:
    marketplace_plugin_unique_identifier: langgenius/tongyi:0.1.0@a2dd9bb656a2722292e8936f3287d53ba176cfbbe9b8bfafc596d4a2ddd99eb2
    version: null
kind: app
version: 0.4.0
workflow:
  conversation_variables: []
  environment_variables: []
  features:
    file_upload:
      allowed_file_extensions:
      - .JPG
      - .JPEG
      - .PNG
      - .GIF
      - .WEBP
      - .SVG
      allowed_file_types:
      - image
      allowed_file_upload_methods:
      - local_file
      - remote_url
      enabled: false
      fileUploadConfig:
        audio_file_size_limit: 50
        batch_count_limit: 5
        file_size_limit: 15
        image_file_size_limit: 10
        video_file_size_limit: 100
        workflow_file_upload_limit: 10
      image:
        enabled: false
        number_limits: 3
        transfer_methods:
        - local_file
        - remote_url
      number_limits: 3
    opening_statement: ''
    retriever_resource:
      enabled: true
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: false
    suggested_questions: []
    suggested_questions_after_answer:
      enabled: false
    text_to_speech:
      enabled: false
      language: ''
      voice: ''
  graph:
    edges:
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: start
        targetType: llm
      id: 1763361675335-source-1763362113268-target
      selected: false
      source: '1763361675335'
      sourceHandle: source
      target: '1763362113268'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: llm
        targetType: code
      id: 1763362113268-source-1763365957228-target
      selected: false
      source: '1763362113268'
      sourceHandle: source
      target: '1763365957228'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: question-classifier
        targetType: knowledge-retrieval
      id: 1763366107839-1-1763366129870-target
      selected: false
      source: '1763366107839'
      sourceHandle: '1'
      target: '1763366129870'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: question-classifier
        targetType: llm
      id: 1763366107839-2-1763366150750-target
      selected: false
      source: '1763366107839'
      sourceHandle: '2'
      target: '1763366150750'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: code
        targetType: if-else
      id: 1763365957228-source-1763366184455-target
      selected: false
      source: '1763365957228'
      sourceHandle: source
      target: '1763366184455'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: question-classifier
      id: 1763366184455-true-1763366107839-target
      selected: false
      source: '1763366184455'
      sourceHandle: 'true'
      target: '1763366107839'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: if-else
        targetType: end
      id: 1763366184455-false-1763366197875-target
      selected: false
      source: '1763366184455'
      sourceHandle: 'false'
      target: '1763366197875'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: llm
        targetType: end
      id: 1763366150750-source-1763367002007-target
      selected: false
      source: '1763366150750'
      sourceHandle: source
      target: '1763367002007'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: knowledge-retrieval
        targetType: llm
      id: 1763366129870-source-1763367195125-target
      selected: false
      source: '1763366129870'
      sourceHandle: source
      target: '1763367195125'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: llm
        targetType: code
      id: 1763367195125-source-1763368075740-target
      selected: false
      source: '1763367195125'
      sourceHandle: source
      target: '1763368075740'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: code
        targetType: loop
      id: 1763368075740-source-1763368375230-target
      selected: false
      source: '1763368075740'
      sourceHandle: source
      target: '1763368375230'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: true
        loop_id: '1763368375230'
        sourceType: loop-start
        targetType: llm
      id: 1763368375230start-source-1763368482856-target
      selected: false
      source: 1763368375230start
      sourceHandle: source
      target: '1763368482856'
      targetHandle: target
      type: custom
      zIndex: 1002
    - data:
        isInIteration: false
        isInLoop: true
        loop_id: '1763368375230'
        sourceType: llm
        targetType: code
      id: 1763368482856-source-1763368517202-target
      selected: false
      source: '1763368482856'
      sourceHandle: source
      target: '1763368517202'
      targetHandle: target
      type: custom
      zIndex: 1002
    - data:
        isInIteration: false
        isInLoop: true
        loop_id: '1763368375230'
        sourceType: code
        targetType: if-else
      id: 1763368517202-source-1763368548981-target
      selected: false
      source: '1763368517202'
      sourceHandle: source
      target: '1763368548981'
      targetHandle: target
      type: custom
      zIndex: 1002
    - data:
        isInIteration: false
        isInLoop: true
        loop_id: '1763368375230'
        sourceType: if-else
        targetType: llm
      id: 1763368548981-true-1763368578143-target
      selected: false
      source: '1763368548981'
      sourceHandle: 'true'
      target: '1763368578143'
      targetHandle: target
      type: custom
      zIndex: 1002
    - data:
        isInIteration: false
        isInLoop: true
        loop_id: '1763368375230'
        sourceType: if-else
        targetType: loop-end
      id: 1763368548981-false-1763368603552-target
      selected: false
      source: '1763368548981'
      sourceHandle: 'false'
      target: '1763368603552'
      targetHandle: target
      type: custom
      zIndex: 1002
    - data:
        isInIteration: false
        isInLoop: true
        loop_id: '1763368375230'
        sourceType: llm
        targetType: code
      id: 1763368578143-source-1763368621379-target
      selected: false
      source: '1763368578143'
      sourceHandle: source
      target: '1763368621379'
      targetHandle: target
      type: custom
      zIndex: 1002
    - data:
        isInIteration: false
        isInLoop: true
        loop_id: '1763368375230'
        sourceType: code
        targetType: assigner
      id: 1763368621379-source-1763368644487-target
      selected: false
      source: '1763368621379'
      sourceHandle: source
      target: '1763368644487'
      targetHandle: target
      type: custom
      zIndex: 1002
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: loop
        targetType: llm
      id: 1763368375230-source-1763368671011-target
      selected: false
      source: '1763368375230'
      sourceHandle: source
      target: '1763368671011'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: llm
        targetType: code
      id: 1763368671011-source-1763368685028-target
      selected: false
      source: '1763368671011'
      sourceHandle: source
      target: '1763368685028'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: code
        targetType: end
      id: 1763368685028-source-1763368706643-target
      selected: false
      source: '1763368685028'
      sourceHandle: source
      target: '1763368706643'
      targetHandle: target
      type: custom
      zIndex: 0
    nodes:
    - data:
        selected: false
        title: å¼€å§‹
        type: start
        variables:
        - default: ''
          hint: ''
          label: query
          max_length: 256
          options: []
          placeholder: ''
          required: true
          type: text-input
          variable: query
        - default: ''
          hint: ''
          label: source_chunk
          max_length: 5000
          options: []
          placeholder: ''
          required: false
          type: paragraph
          variable: source_chunk
      height: 114
      id: '1763361675335'
      position:
        x: 80
        y: 282
      positionAbsolute:
        x: 80
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        context:
          enabled: true
          variable_selector:
          - - '1763361675335'
            - source_chunk
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: qwen3-vl-32b-thinking
          provider: langgenius/tongyi/tongyi
        prompt_template:
        - id: 501cfc64-d860-475c-b5bf-793131a9aeb2
          role: system
          text: "ä½ æ˜¯ä¸€ä¸ªé—®ç­”è¯„ä¼°åŠ©æ‰‹ï¼Œè´Ÿè´£åˆ¤æ–­åœ¨ç»™å®šã€ä¸Šä¸‹æ–‡ã€‘çš„æƒ…å†µä¸‹ï¼Œæ˜¯å¦å¯ä»¥åˆç†å›ç­”æŒ‡å®šçš„ã€é—®é¢˜ã€‘ã€‚\n\nä½ çš„ä»»åŠ¡ï¼š\n- æ ¹æ®æä¾›çš„ä¸Šä¸‹æ–‡ï¼Œåˆ¤æ–­â€œæ˜¯å¦æœ‰è¶³å¤Ÿä¿¡æ¯å¯ä»¥ç»™å‡ºä¸€ä¸ªåˆç†å›ç­”â€ã€‚\n- æ ‡å‡†ä¸è¦è¿‡äºä¸¥æ ¼ï¼Œåªè¦å¤§è‡´å¯ä»¥ä½œç­”ï¼Œå°±ç®—å¯ä»¥å›ç­”ã€‚\n\nè¯·åªè¾“å‡ºä¸€ä¸ª JSON å¯¹è±¡ï¼Œä¸è¦æ·»åŠ å¤šä½™è¯´æ˜ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š\n{\n  \"is_valid\": true æˆ– false,\n  \"reason\": \"ç”¨ä¸€ä¸¤å¥è¯ç®€å•è¯´æ˜åŸå› \"\n}\n\nè¯„ä¼°ç»´åº¦ï¼ˆæŒ‰å®½æ¾æ ‡å‡†ï¼‰ï¼š\n1. å®Œæ•´æ€§ï¼šä¸Šä¸‹æ–‡æ˜¯å¦åŒ…å«ä¸é—®é¢˜ç›¸å…³çš„æ ¸å¿ƒä¿¡æ¯ï¼Œè‡³å°‘èƒ½æ”¯æ’‘ä¸€ä¸ªå¤§è‡´æ­£ç¡®æˆ–åˆç†çš„å›ç­”ã€‚\n2. å¯å›ç­”æ€§ï¼šä¸æ˜¯é‚£ç§æ˜æ˜¾â€œè¶…å‡ºä¸Šä¸‹æ–‡èŒƒå›´ã€éœ€è¦é¢å¤–å¸¸è¯†æˆ–å¤–éƒ¨çŸ¥è¯†æ‰èƒ½å›ç­”â€çš„é—®é¢˜ï¼›å¦‚æœåªé ä¸Šä¸‹æ–‡å®Œå…¨ç­”ä¸å‡ºæ¥ï¼Œåˆ¤ä¸º falseã€‚\n3. æ­§ä¹‰æ€§ï¼šå¦‚æœé—®é¢˜ä¸¥é‡æ­§ä¹‰ã€æ— æ³•åˆ¤æ–­å®ƒåœ¨é—®ä»€ä¹ˆï¼Œä¸”ä¸Šä¸‹æ–‡ä¹Ÿæ— æ³•æ¶ˆé™¤æ­§ä¹‰ï¼Œåˆ™åˆ¤ä¸º falseï¼›å¦‚æœèƒ½å¤Ÿç»™å‡ºä¸€ä¸ªåˆç†è§£é‡Šæ–¹å‘ï¼Œåˆ™å¯ä»¥åˆ¤ä¸º trueã€‚\n\nå…·ä½“è§„åˆ™ï¼š\n- è‹¥ä¸Šä¸‹æ–‡ä¸­å‡ºç°äº†ä¸é—®é¢˜ç›´æ¥ç›¸å…³çš„äº‹å®ã€å®šä¹‰ã€ç»“è®ºæˆ–æ¨ç†çº¿ç´¢ â†’ é€šå¸¸åˆ¤ä¸º trueã€‚\n- è‹¥ä¸Šä¸‹æ–‡å®Œå…¨æ²¡æœ‰æ¶‰åŠç›¸å…³ä¸»é¢˜ï¼Œæˆ–åªæ˜¯ä¸€ç‚¹ç‚¹æ¨¡ç³Šå…³è”ï¼Œæ— æ³•æ”¯æ’‘å›ç­” â†’ åˆ¤ä¸º falseã€‚\n- è‹¥åªæ˜¯ç¼ºå°‘ä¸€äº›ç»†ææœ«èŠ‚ï¼Œä½†ä¸»ä½“ä¿¡æ¯é½å…¨ â†’ ä»ç„¶åˆ¤ä¸º trueã€‚\n- ä¸éœ€è¦è€ƒè™‘ç­”æ¡ˆæ˜¯å¦ä¼˜ç¾ï¼Œåªå…³æ³¨â€œæ˜¯å¦æœ‰ä¿¡æ¯å¯ä»¥å›ç­”â€ã€‚\n\nã€ä¸Šä¸‹æ–‡ã€‘ï¼š\n{{#context#}}\n\nã€å¾…è¯„ä¼°çš„é—®é¢˜ã€‘ï¼š\n{{#1763361675335.query#}}\n\nè¯·åŸºäºä¸Šè¿°è§„åˆ™è¾“å‡º JSONã€‚\n"
        selected: false
        title: é—®é¢˜åˆæ ¼åˆ¤æ–­
        type: llm
        vision:
          enabled: false
      height: 88
      id: '1763362113268'
      position:
        x: 380.4842834334896
        y: 282
      positionAbsolute:
        x: 380.4842834334896
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        code: "import json\nimport re\n\ndef strip_think_block(text: str) -> str:\n    \"\"\"å»æ‰ <think>...</think>ã€‚\"\"\"\n    pattern = re.compile(r\"<think>.*?</think>\", re.DOTALL | re.IGNORECASE)\n    return pattern.sub(\"\", text).strip()\n\ndef strip_code_fence(text: str) -> str:\n    \"\"\"å»æ‰ ```json / ``` ç­‰ä»£ç å—æ ‡è®°ã€‚\"\"\"\n    text = text.strip()\n    # å»å¼€å¤´ ```xxx\n    text = re.sub(r\"^```[a-zA-Z0-9_]*\", \"\", text).strip()\n    # å»ç»“å°¾ ```\n    text = re.sub(r\"```$\", \"\", text).strip()\n    return text\n\ndef parse_json_loose(text: str) -> dict:\n    \"\"\"å®½æ¾è§£æ JSONï¼šå…ˆæ•´ä½“ parseï¼Œå¤±è´¥å†ä»ä¸­æå– {...}ã€‚\"\"\"\n    text = text.strip()\n    # ç›´æ¥ parse\n    try:\n        data = json.loads(text)\n        if isinstance(data, dict):\n            return data\n    except Exception:\n        pass\n\n    # æå–ç¬¬ä¸€æ®µ {...}\n    m = re.search(r\"\\{.*\\}\", text, re.DOTALL)\n    if m:\n        try:\n            data = json.loads(m.group(0))\n            if isinstance(data, dict):\n                return data\n\
          \        except Exception:\n            pass\n\n    return {}\n\ndef main(response: str) -> dict:\n    \"\"\"\n    è¾“å…¥:\n        response: è¯„ä¼° LLM çš„å®Œæ•´è¾“å‡ºï¼ˆå¯èƒ½å« <think>ã€```json``` ç­‰ï¼‰\n    è¾“å‡º:\n        is_valid: \"true\" or \"false\" å­—ç¬¦ä¸²\n    \"\"\"\n    if response is None:\n        response = \"\"\n    text = response.strip()\n\n    # 1. å»æ‰æ€ç»´é“¾\n    text = strip_think_block(text)\n\n    # 2. å»æ‰ä»£ç å—åŒ…è£¹\n    text = strip_code_fence(text)\n\n    # 3. è§£æ JSON\n    data = parse_json_loose(text)\n\n    # 4. æå– is_validï¼Œå¹¶è½¬æˆå­—ç¬¦ä¸²\n    is_valid_bool = False\n    if isinstance(data, dict) and \"is_valid\" in data:\n        v = data[\"is_valid\"]\n        if isinstance(v, bool):\n            is_valid_bool = v\n        elif isinstance(v, str):\n            is_valid_bool = v.strip().lower() in (\"true\", \"1\", \"yes\", \"y\")\n\n    return {\n        \"is_valid\": \"true\" if is_valid_bool else \"false\"\n    }\n"
        code_language: python3
        outputs:
          clean_response:
            children: null
            type: string
          is_valid:
            children: null
            type: string
          raw_json:
            children: null
            type: string
          reason:
            children: null
            type: string
        selected: false
        title: åˆæ ¼åˆ¤æ–­ç»“æœæå–
        type: code
        variables:
        - value_selector:
          - '1763362113268'
          - text
          value_type: string
          variable: response
      height: 52
      id: '1763365957228'
      position:
        x: 684
        y: 282
      positionAbsolute:
        x: 684
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        classes:
        - id: '1'
          name: ä¸èˆªå¤©é¢†åŸŸç›´æ¥æˆ–é—´æ¥ç›¸å…³çš„é—®é¢˜
        - id: '2'
          name: å…¶ä»–
        instructions: ''
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: qwen3-vl-8b-thinking
          provider: langgenius/tongyi/tongyi
        query_variable_selector:
        - '1763361675335'
        - query
        selected: false
        title: é—®é¢˜åˆ†ç±»å™¨
        type: question-classifier
        vision:
          enabled: false
      height: 170
      id: '1763366107839'
      position:
        x: 1428.5068543634727
        y: 282
      positionAbsolute:
        x: 1428.5068543634727
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        dataset_ids:
        - bwuUJyzBKR/eDVpWlGXu+sSboBMXljKhY4qESQS5n8/SVANpQxHcl37BsKvGlxfa
        multiple_retrieval_config:
          reranking_enable: true
          reranking_mode: reranking_model
          reranking_model:
            model: netease-youdao/bce-reranker-base_v1
            provider: langgenius/siliconflow/siliconflow
          top_k: 5
        query_variable_selector:
        - '1763361675335'
        - query
        retrieval_mode: multiple
        selected: false
        title: è’¸é¦é˜¶æ®µçŸ¥è¯†æ£€ç´¢
        type: knowledge-retrieval
      height: 90
      id: '1763366129870'
      position:
        x: 1781.967662883615
        y: 320.2657294124139
      positionAbsolute:
        x: 1781.967662883615
        y: 320.2657294124139
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        context:
          enabled: false
          variable_selector: []
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: qwen3-vl-8b-thinking
          provider: langgenius/tongyi/tongyi
        prompt_template:
        - id: 0ad6bcef-2e34-4b3a-bc1e-a827e2aec64e
          role: system
          text: ä½ æ˜¯ä¸€ä¸ªé€šç”¨çš„åŠ©æ‰‹ï¼Œè¯·æ ¹æ®é—®é¢˜æ·±å…¥æ€è€ƒä»¥åç»™å‡ºå‡†ç¡®ã€ä¸“ä¸šã€å…¨é¢ã€ç³»ç»Ÿã€æœ‰æ·±åº¦çš„å›ç­”ã€‚
        - id: dedc6534-6ea1-465b-8045-d43a59cf9adf
          role: user
          text: è¯·å›ç­”ä¸€ä¸‹é—®é¢˜{{#1763361675335.query#}}
        selected: false
        title: é€šç”¨é—®é¢˜å›ç­”
        type: llm
        vision:
          enabled: false
      height: 88
      id: '1763366150750'
      position:
        x: 1781.967662883615
        y: 487.7971882372418
      positionAbsolute:
        x: 1781.967662883615
        y: 487.7971882372418
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        cases:
        - case_id: 'true'
          conditions:
          - comparison_operator: contains
            id: e11d51bd-4c91-454b-bdcd-12d6c0dfa5bf
            value: 'true'
            varType: string
            variable_selector:
            - '1763365957228'
            - is_valid
          id: 'true'
          logical_operator: and
        selected: false
        title: æ¡ä»¶åˆ†æ”¯
        type: if-else
      height: 124
      id: '1763366184455'
      position:
        x: 1055.752459170974
        y: 282
      positionAbsolute:
        x: 1055.752459170974
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        outputs:
        - value_selector:
          - '1763365957228'
          - is_valid
          value_type: string
          variable: is_valid
        - value_selector:
          - '1763362113268'
          - text
          value_type: string
          variable: text
        selected: false
        title: é—®é¢˜ä¸åˆæ ¼
        type: end
      height: 114
      id: '1763366197875'
      position:
        x: 1786.093498182927
        y: 663.5237261697987
      positionAbsolute:
        x: 1786.093498182927
        y: 663.5237261697987
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        outputs:
        - value_selector:
          - '1763366150750'
          - text
          value_type: string
          variable: text
        - value_selector:
          - '1763365957228'
          - is_valid
          value_type: string
          variable: is_valid
        - value_selector:
          - '1763366107839'
          - class_name
          value_type: string
          variable: class_name
        selected: false
        title: é€šç”¨é—®é¢˜è’¸é¦
        type: end
      height: 140
      id: '1763367002007'
      position:
        x: 2085.967662883615
        y: 487.7971882372418
      positionAbsolute:
        x: 2085.967662883615
        y: 487.7971882372418
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        context:
          enabled: true
          variable_selector:
          - '1763366129870'
          - result
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: Pro/deepseek-ai/DeepSeek-R1
          provider: langgenius/siliconflow/siliconflow
        prompt_config:
          jinja2_variables: []
        prompt_template:
        - edition_type: basic
          id: 035fb2c1-eaed-4c68-bc09-70840a86a357
          role: system
          text: "ä½ æ˜¯ä¸€åèˆªå¤©é¢†åŸŸçš„èµ„æ·±ä¸“å®¶ä¸æŠ€æœ¯å†™ä½œè€…ï¼Œæ“…é•¿æŠŠå¤æ‚çš„å·¥ç¨‹æŠ€æœ¯é—®é¢˜è®²è§£å¾—ä¸¥è°¨ã€ç³»ç»Ÿåˆé€šä¿—ã€‚\n\nå›ç­”æ€»ä½“è¦æ±‚ï¼š\n1. ä¸“ä¸šå‡†ç¡®  \n   - ä¼˜å…ˆä»¥ä¸Šä¸‹æ–‡ä¸­çš„äº‹å®å’Œç»“è®ºä¸ºä¾æ®ï¼Œå¿…è¦æ—¶å¯ä»¥ç»“åˆå¸¸è¯†å’Œåˆç†æ¨ç†è¿›è¡Œè¡¥å……ã€‚  \n   - é¿å…æ˜æ˜¾ä¸ä¸Šä¸‹æ–‡ç›¸çŸ›ç›¾çš„å†…å®¹ï¼Œä¸è¦çç¼–å…·ä½“æ•°å­—ã€å‹å·ã€å…¬å¼ã€‚\n\n2. å…¨é¢ç³»ç»Ÿ  \n   - å…ˆç»™å‡ºç®€æ´ç»“è®ºï¼Œå†åˆ†æ¡è§£é‡ŠåŸå› ã€åŸç†ã€å…³é”®æ­¥éª¤æˆ–å½±å“å› ç´ ã€‚  \n   - èƒ½åˆ†å±‚ç»„ç»‡çš„ï¼Œå°½é‡ç”¨ã€Œ1. 2. 3.ã€æˆ–ã€Œï¼ˆ1ï¼‰ï¼ˆ2ï¼‰ï¼ˆ3ï¼‰ã€ç­‰ç»“æ„åŒ–æ–¹å¼å‘ˆç°ï¼Œæ–¹ä¾¿åç»­ä½œä¸ºè®­ç»ƒæ•°æ®ä½¿ç”¨ã€‚\n\n3. é€»è¾‘æ¸…æ™°ã€å¯è¯»æ€§å¥½  \n   - æ®µè½æ¸…æ™°ï¼Œé¿å…é•¿å¥å †ç Œï¼›å¯¹é‡è¦æ¦‚å¿µå¯ä»¥å…ˆä¸‹å®šä¹‰å†å±•å¼€ã€‚  \n   - å°½é‡ç”¨è‡ªç„¶è¯­è¨€è§£é‡ŠåŸç†ï¼Œè€Œä¸æ˜¯åªç»™å‡ºç¬¦å·å’Œå †å åè¯ã€‚\n\n4. ä¸æš´éœ²â€œç³»ç»Ÿå†…éƒ¨ä¿¡æ¯â€  \n   - ä¸è¦å‡ºç°è¯¸å¦‚â€œæ ¹æ®æ£€ç´¢åˆ°çš„æ–‡æ¡£â€â€œæ ¹æ®ä¸Šæ–‡ç‰‡æ®µâ€â€œRAG ç³»ç»Ÿâ€â€œçŸ¥è¯†åº“â€â€œè’¸é¦æ•°æ®â€ç­‰æè¿°ã€‚  \n   - æŠŠå›ç­”å†™æˆåƒæ˜¯ç›´æ¥é¢å‘è¯»è€…çš„ä¸“ä¸šè§£ç­”ï¼Œè€Œä¸æ˜¯åœ¨è¯´æ˜ä½ æ˜¯å¦‚ä½•æ£€ç´¢åˆ°ä¿¡æ¯çš„ã€‚\n\n5. ä¿¡æ¯ä¸è¶³æ—¶çš„å¤„ç†  \n   - å¦‚æœä¸Šä¸‹æ–‡æ— æ³•æ”¯æ’‘ç²¾ç¡®ç»“è®ºï¼Œå¯ä»¥ç»™å‡ºã€Œå¤§è‡´èŒƒå›´ã€ã€Œä¸€èˆ¬åšæ³•ã€ã€Œå…¸å‹æ–¹æ¡ˆã€ï¼Œå¹¶è¯´æ˜å­˜åœ¨ä¸ç¡®å®šæ€§ã€‚  \n   - å®åœ¨æ— æ³•å›ç­”æ—¶ï¼Œå¯ä»¥æ˜ç¡®è¯´æ˜â€œä»ç°æœ‰èµ„æ–™æ— æ³•ç¡®å®šâ€ï¼Œä¸è¦ç¼–é€ ç»†èŠ‚ã€‚\n\nè¾“å‡ºè¯­è¨€ï¼š\n- ä½¿ç”¨ç®€ä½“ä¸­æ–‡å›ç­”ã€‚\n- ä¸è¾“å‡ºæ€è€ƒè¿‡ç¨‹è¯´æ˜å¥ï¼ˆä¾‹å¦‚â€œæˆ‘å°†ä»ä¸‰ä¸ªæ–¹é¢åˆ†æâ€å¯ä»¥ä¿ç•™ï¼Œä½†ä¸è¦è§£é‡Šä½ åœ¨ç”¨ä»€ä¹ˆæ¨¡å‹æˆ–ç­–ç•¥ï¼‰ã€‚\n\n"
        - id: 200b9b53-bbc8-4c3a-a529-4ba144b14281
          role: user
          text: 'ä½ çš„ä»»åŠ¡ï¼š

            - ç»“åˆæä¾›çš„{{#context#}}ä¸{{#1763361675335.query#}}è¿›è¡Œæ·±å…¥æ€è€ƒï¼›

            - åœ¨ä¸æš´éœ²â€œæ£€ç´¢â€â€œçŸ¥è¯†åº“â€â€œRAGâ€â€œè’¸é¦â€ç­‰æŠ€æœ¯ç»†èŠ‚çš„å‰æä¸‹ï¼Œè¾“å‡ºä¸€ä»½é€‚åˆä½œä¸ºæ•™å­¦ç¤ºä¾‹çš„é«˜è´¨é‡å›ç­”ã€‚


            è¯·ä½ æŒ‰ç…§ SYSTEM ä¸­çš„è¦æ±‚ï¼ŒåŸºäºä¸Šè¿°çŸ¥è¯†ç‰‡æ®µï¼Œå¯¹è¿™ä¸ªé—®é¢˜ç»™å‡ºä¸€ä»½ä¸“ä¸šã€å…¨é¢ã€ç»“æ„æ¸…æ™°çš„å›ç­”ã€‚

            å¦‚æœå¤šä¸ªç‰‡æ®µä¹‹é—´å­˜åœ¨å·®å¼‚ï¼Œè¯·å°½é‡ç»™å‡ºåˆç†çš„å½’çº³ä¸è§£é‡Šã€‚'
        selected: false
        title: èˆªå¤©RAGçŸ¥è¯†è’¸é¦
        type: llm
        vision:
          enabled: false
      height: 88
      id: '1763367195125'
      position:
        x: 2083.967662883615
        y: 320.2657294124139
      positionAbsolute:
        x: 2083.967662883615
        y: 320.2657294124139
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        code: "def main(rag_distill_response: str) -> dict:\n    \"\"\"\n    è¾“å…¥ï¼š\n        rag_distill_response: ä¸Šæ¸¸ RAG è’¸é¦èŠ‚ç‚¹çš„å®Œæ•´è¾“å‡ºï¼ˆå« <think> æ ‡ç­¾ï¼‰\n    è¾“å‡ºï¼š\n        answer: å»æ‰ <think> æ€ç»´é“¾åçš„æœ€ç»ˆå›ç­”\n        cot:    <think>...</think> ä¸­çš„æ€ç»´é“¾å†…å®¹\n    \"\"\"\n\n    if rag_distill_response is None:\n        rag_distill_response = \"\"\n\n    text = rag_distill_response.strip()\n    cot = \"\"\n    answer = text\n\n    # åŒæ—¶å­˜åœ¨ <think> å’Œ </think> æ‰æ‹†åˆ†\n    if \"<think>\" in text and \"</think>\" in text:\n        start_index = text.find(\"<think>\")\n        end_index = text.find(\"</think>\", start_index)\n\n        if end_index != -1:\n            # å–å‡ºæ€ç»´é“¾\n            cot = text[start_index + len(\"<think>\"): end_index].strip()\n            # å–å‡ºæ€ç»´é“¾åé¢çš„å†…å®¹ä½œä¸ºæœ€ç»ˆå›ç­”\n            answer = text[end_index + len(\"</think>\"):].strip()\n\n    # è¿”å›ç»™ Dify çš„è¾“å‡ºå˜é‡ï¼Œåå­—è¦å’Œä¸‹é¢é…ç½®é‡Œçš„è¾“å‡ºå˜é‡ä¸€è‡´\n    return {\n        \"answer\": answer,\n        \"cot\": cot,\n    }\n"
        code_language: python3
        outputs:
          answer:
            children: null
            type: string
          cot:
            children: null
            type: string
        selected: false
        title: COTä¸ANSWERåˆ†ç¦»
        type: code
        variables:
        - value_selector:
          - '1763367195125'
          - text
          value_type: string
          variable: rag_distill_response
      height: 52
      id: '1763368075740'
      position:
        x: 2384.4519463171046
        y: 320.2657294124139
      positionAbsolute:
        x: 2384.4519463171046
        y: 320.2657294124139
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        break_conditions: []
        error_handle_mode: terminated
        height: 453
        logical_operator: and
        loop_count: 5
        loop_variables:
        - id: 6c32f350-dfd2-433e-8621-ccdd1ecd72f9
          label: answer
          value:
          - '1763368075740'
          - answer
          value_type: variable
          var_type: string
        selected: false
        start_node_id: 1763368375230start
        title: å¾ªç¯
        type: loop
        width: 1896
      height: 453
      id: '1763368375230'
      position:
        x: 2707.5991667145195
        y: 320.2657294124139
      positionAbsolute:
        x: 2707.5991667145195
        y: 320.2657294124139
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 1896
      zIndex: 1
    - data:
        desc: ''
        isInLoop: true
        selected: false
        title: ''
        type: loop-start
      draggable: false
      height: 48
      id: 1763368375230start
      parentId: '1763368375230'
      position:
        x: 24
        y: 68
      positionAbsolute:
        x: 2731.5991667145195
        y: 388.2657294124139
      selectable: false
      sourcePosition: right
      targetPosition: left
      type: custom-loop-start
      width: 44
      zIndex: 1002
    - data:
        context:
          enabled: true
          variable_selector:
          - '1763366129870'
          - result
        isInIteration: false
        isInLoop: true
        loop_id: '1763368375230'
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: qwen3-vl-32b-thinking
          provider: langgenius/tongyi/tongyi
        prompt_template:
        - id: 202478ba-eeb6-4bbd-ac4c-09ba5e825b00
          role: system
          text: 'ä½ æ˜¯ä¸€åèˆªå¤©é¢†åŸŸçš„é—®ç­”è´¨æ£€ä¸“å®¶ã€‚ç°åœ¨éœ€è¦ä½ æ ¹æ®{{#context#}}å’Œ{{#1763361675335.query#}}è¿›è¡Œå‡†ç¡®æ€§ä¸å…¨é¢æ€§æ£€æŸ¥ã€‚


            ä½ çš„ä»»åŠ¡ï¼š

            1. å¯¹ç…§ç›¸å…³æ–‡æœ¬ï¼Œæ£€æŸ¥å›ç­”ä¸­æ˜¯å¦æœ‰æ˜æ˜¾é”™è¯¯æˆ–ä¸æ–‡æœ¬çŸ›ç›¾ä¹‹å¤„ã€‚

            2. æ ‡è®°å›ç­”ä¸­ä¸æ–‡æœ¬æ— å…³ã€æ¨æ–­è¿‡åº¦æˆ–æ˜æ˜¾çç¼–çš„å†…å®¹ã€‚

            3. æ£€æŸ¥å›ç­”æ˜¯å¦è¦†ç›–äº†æ–‡æœ¬ä¸­ä¸é—®é¢˜ç´§å¯†ç›¸å…³çš„å…³é”®ä¿¡æ¯ï¼Œé¿å…é—æ¼é‡è¦ç‚¹ã€‚

            4. å¯ä»¥é€‚å½“æ¦‚æ‹¬ã€åˆå¹¶åŒç±»é¡¹ï¼Œä½†ä¸è¦å¼•å…¥æ–‡æœ¬ä¸­æ²¡æœ‰ä¾æ®çš„æ–°ç»“è®ºã€‚


            æœ€ç»ˆè¯·è¾“å‡ºç»“æ„åŒ–ç»“è®ºï¼ˆä¾‹å¦‚ï¼šæ˜¯å¦é€šè¿‡æ ¡éªŒã€é”™è¯¯ç‚¹/é—æ¼ç‚¹ç®€è¦è¯´æ˜ï¼‰ï¼Œè¯­è¨€ä½¿ç”¨ç®€ä½“ä¸­æ–‡ã€‚'
        selected: false
        title: å‡†ç¡®æ€§ä¸å…¨é¢æ€§æ ¡éªŒ
        type: llm
        vision:
          enabled: false
      height: 88
      id: '1763368482856'
      parentId: '1763368375230'
      position:
        x: 128
        y: 68
      positionAbsolute:
        x: 2835.5991667145195
        y: 388.2657294124139
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
      zIndex: 1002
    - data:
        code: "def main(response: str) -> dict:\n    \"\"\"\n    è¾“å…¥:\n        response: è´¨æ£€ LLM çš„å®Œæ•´è¾“å‡ºï¼ˆå¯èƒ½åŒ…å« <think>...</think> å’Œ check_passed / check_failedï¼‰\n    è¾“å‡º:\n        check_passed: \"true\" / \"false\" å­—ç¬¦ä¸²ï¼Œç”¨äºåç»­æ¡ä»¶åˆ†æ”¯\n    \"\"\"\n    if response is None:\n        response = \"\"\n\n    text = response.strip()\n\n    # 1. å»æ‰ <think>...</think> æ€ç»´é“¾ï¼Œåªä¿ç•™çœŸæ­£çš„ç»“è®ºéƒ¨åˆ†\n    if \"<think>\" in text and \"</think>\" in text:\n        end_index = text.find(\"</think>\")\n        text = text[end_index + len(\"</think>\"):].strip()\n\n    # 2. åˆ¤æ–­æ˜¯å¦é€šè¿‡æ ¡éªŒ\n    # æœ‰ check_passed å°±è®¤ä¸ºé€šè¿‡ï¼›æœ‰ check_failed å°±è®¤ä¸ºæœªé€šè¿‡ï¼›\n    # å¦‚æœéƒ½æ²¡æœ‰ï¼Œé»˜è®¤æœªé€šè¿‡ï¼ˆä½ ä¹Ÿå¯ä»¥æŒ‰éœ€æ”¹æˆé»˜è®¤é€šè¿‡ï¼‰\n    passed = \"false\"\n    if \"check_passed\" in text:\n        passed = \"true\"\n    elif \"check_failed\" in text:\n        passed = \"false\"\n\n    # 3. è¿”å›ç»™ Difyï¼Œå˜é‡åè¦å’Œä¸‹æ–¹â€œè¾“å‡ºå˜é‡â€é…ç½®ä¸€è‡´\n    return {\n        \"check_passed\": passed\n    }\n"
        code_language: python3
        isInIteration: false
        isInLoop: true
        loop_id: '1763368375230'
        outputs:
          check_passed:
            children: null
            type: string
        selected: false
        title: æ ¡éªŒå›ç­”æå–
        type: code
        variables:
        - value_selector:
          - '1763368482856'
          - text
          value_type: string
          variable: response
      height: 52
      id: '1763368517202'
      parentId: '1763368375230'
      position:
        x: 431.14869835499667
        y: 68
      positionAbsolute:
        x: 3138.747865069516
        y: 388.2657294124139
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
      zIndex: 1002
    - data:
        cases:
        - case_id: 'true'
          conditions:
          - comparison_operator: contains
            id: d05a5fa3-e387-43f9-94a0-e222ea3ca186
            value: check_passed
            varType: string
            variable_selector:
            - '1763368517202'
            - check_passed
          id: 'true'
          logical_operator: and
        isInIteration: false
        isInLoop: true
        loop_id: '1763368375230'
        selected: false
        title: æ ¡éªŒé€šè¿‡åˆ¤å®š
        type: if-else
      height: 124
      id: '1763368548981'
      parentId: '1763368375230'
      position:
        x: 745.6414490985935
        y: 68.03143313302076
      positionAbsolute:
        x: 3453.240615813113
        y: 388.2971625454347
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
      zIndex: 1002
    - data:
        context:
          enabled: true
          variable_selector:
          - '1763366129870'
          - result
        isInIteration: false
        isInLoop: true
        loop_id: '1763368375230'
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: qwen3-vl-32b-thinking
          provider: langgenius/tongyi/tongyi
        prompt_template:
        - id: d401be78-a3b5-4b69-95d4-2cc628c85278
          role: system
          text: "ä½ æ˜¯ä¸€åèˆªå¤©é¢†åŸŸçš„é—®ç­”æ”¹å†™ä¸“å®¶ã€‚\n\nç°åœ¨æœ‰ä¸€ä¸ªã€Œé’ˆå¯¹æŸä¸ªé—®é¢˜çš„å›ç­”ã€åœ¨å‡†ç¡®æ€§ä¸å…¨é¢æ€§æ ¡éªŒä¸­æœªé€šè¿‡ã€‚\nè¯·ä½ ç»¼åˆä¸‹é¢æä¾›çš„ä¿¡æ¯ï¼šé—®é¢˜ã€é—®é¢˜æ¥æºæ–‡æœ¬ã€åŸå§‹å›ç­”ã€å‚è€ƒæ–‡æœ¬ï¼Œä»¥åŠæœªé€šè¿‡æ ¡éªŒçš„åŸå› ï¼Œé‡æ–°å†™å‡ºä¸€ä¸ªç¬¦åˆè¦æ±‚çš„é«˜è´¨é‡å›ç­”ã€‚\n\n-------------------------\nã€å¾…è§£å†³çš„é—®é¢˜ã€‘ï¼š\n{{#1763361675335.query#}}\n\nã€é—®é¢˜ç›¸å…³æ¥æºæ–‡æœ¬ã€‘ï¼š\n{{#1763361675335.source_chunk#}}\n\nã€åŸå§‹å›ç­”ã€‘ï¼š\n{{#1763368375230.answer#}}\n\nã€å¯ä¾›å‚è€ƒçš„å…¶ä»–æ–‡æœ¬ã€‘ï¼š\n{{#context#}}\n\nã€æœªé€šè¿‡æ ¡éªŒçš„åŸå› ã€‘ï¼š\n{{#1763368482856.text#}}\n-------------------------\n\nåœ¨æ”¹å†™è¿‡ç¨‹ä¸­ï¼Œè¯·ä¸¥æ ¼éµå®ˆä»¥ä¸‹è§„åˆ™ï¼š\n\n1. å¯¹äºã€Œæœªé€šè¿‡æ ¡éªŒåŸå› ã€ä¸­æŒ‡å‡ºçš„é—®é¢˜ï¼Œå¿…é¡»ç»“åˆå‚è€ƒæ–‡æœ¬è¿›è¡Œä¸¥è°¨ä¿®æ”¹ï¼Œä¿®æ­£é”™è¯¯æˆ–è¡¥è¶³ç¼ºå¤±ä¿¡æ¯ã€‚\n2. å¯¹äºæœªè¢«æŒ‡å‡ºé—®é¢˜çš„éƒ¨åˆ†ï¼Œä¹Ÿè¦ç»“åˆå‚è€ƒæ–‡æœ¬ï¼Œåœ¨ä¿è¯çœŸå®æ€§å’Œä¸“ä¸šæ€§çš„å‰æä¸‹é€‚å½“è¡¥å……å’Œæ¶¦è‰²ï¼Œä½¿å†…å®¹æ›´åŠ æ¸…æ™°ã€å®Œæ•´ã€‚\n3. æ”¹å†™åçš„å›ç­”è¦ï¼š\n   - è¦†ç›–ä¸é—®é¢˜å¯†åˆ‡ç›¸å…³çš„å…³é”®ä¿¡æ¯ï¼›\n   - ç»“æ„æ¸…æ™°ã€å±‚æ¬¡åˆ†æ˜ï¼Œå¯ä»¥æŒ‰æ¡ç›®æˆ–æ­¥éª¤å±•å¼€ï¼›\n   - åœ¨ä¿è¯ä¿¡æ¯å……åˆ†çš„å‰æä¸‹å°½é‡ç²¾ç‚¼ï¼Œä¸è¦å †ç Œæ— å…³å†…å®¹ã€‚\n4. è‹¥æ¶‰åŠæ¡ä»¶ã€æ­¥éª¤ã€æµç¨‹æˆ–å¤šç§æ–¹æ¡ˆï¼Œå¯ä»¥å…ˆç»™å‡ºæ•´ä½“ç»“è®ºï¼Œå†åˆ†ç‚¹è¯´æ˜ï¼Œå†åšä¸€ä¸ªç®€è¦æ€»ç»“ã€‚\n5. åˆ é™¤åŸå›ç­”ä¸­å†—ä½™ã€æ¨¡ç³Šã€é€»è¾‘ä¸æ¸…æˆ–æ˜æ˜¾ä¸ç¡®å®šçš„è¡¨è¿°ã€‚\n6. å›ç­”ä¸­ä¸è¦å‡ºç°ç±»ä¼¼â€œåœ¨æ–‡æœ¬ä¸­â€â€œåœ¨ä¸Šè¿°ç‰‡æ®µé‡Œâ€è¿™ç±»å¯¹å…·ä½“æ®µè½çš„å…ƒå¼•ç”¨ï¼Œä½†å¯ä»¥ç›´æ¥å¼•ç”¨å…¶ä¸­çš„äº‹å®ã€ç»“è®ºå’Œæ•°æ®ã€‚\n7. è‹¥å›ç­”ä¸­åŒ…å«å…¬å¼æˆ–æ•°å­¦è¡¨è¾¾ï¼Œè¯·ä½¿ç”¨å…¼å®¹ Markdown çš„æ ¼å¼ä¹¦å†™ã€‚\n8. è¯·ç›´æ¥ç»™å‡ºæ”¹å†™åçš„æœ€ç»ˆå›ç­”ï¼Œä¸è¦è§£é‡Šä½ çš„æ€è€ƒè¿‡ç¨‹ï¼Œä¸è¦å‡ºç°ç±»ä¼¼â€œä»¥ä¸‹æ˜¯æ”¹å†™åçš„ç­”æ¡ˆâ€æˆ–è€…â€æ–‡ä¸­XXâ€œä¸”ä¸è¦å‡ºç°â€check_passedâ€œç­‰ç±»ä¼¼å­—æ ·ã€‚\n"
        selected: false
        title: å›ç­”æ”¹å†™
        type: llm
        vision:
          enabled: false
      height: 88
      id: '1763368578143'
      parentId: '1763368375230'
      position:
        x: 1035.7411011265922
        y: 66.25889887340776
      positionAbsolute:
        x: 3743.3402678411117
        y: 386.5246282858217
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
      zIndex: 1002
    - data:
        isInIteration: false
        isInLoop: true
        loop_id: '1763368375230'
        selected: false
        title: é€€å‡ºå¾ªç¯
        type: loop-end
      height: 54
      id: '1763368603552'
      parentId: '1763368375230'
      position:
        x: 1034
        y: 195
      positionAbsolute:
        x: 3741.5991667145195
        y: 515.265729412414
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom-simple
      width: 244
      zIndex: 1002
    - data:
        code: "def main(rewritten_respc: str) -> dict:\n    \"\"\"\n    è¾“å…¥ï¼š\n        rewritten_respc: æ”¹å†™èŠ‚ç‚¹çš„å®Œæ•´è¾“å‡ºï¼ˆå¯èƒ½åŒ…å« <think>...</think> å’Œ check_passedï¼‰\n    è¾“å‡ºï¼š\n        answer: å»æ‰æ€ç»´é“¾å’Œæ ‡è®°ä¹‹åçš„æœ€ç»ˆç­”æ¡ˆ\n    \"\"\"\n    if rewritten_respc is None:\n        rewritten_respc = \"\"\n\n    text = rewritten_respc.strip()\n\n    # å¦‚æœåŒ…å« <think>...</think>ï¼Œåªå–ååŠæ®µä½œä¸ºç­”æ¡ˆ\n    if \"<think>\" in text and \"</think>\" in text:\n        end_index = text.find(\"</think>\")\n        answer = text[end_index + len(\"</think>\"):].strip()\n    else:\n        answer = text\n\n    # å»æ‰ç”¨äºæ ‡è®°çš„ check_passedï¼ˆé˜²æ­¢å†™åœ¨ä¸­é—´å¤šæ¬¡å‡ºç°ï¼Œç»Ÿä¸€æ¸…ä¸€ä¸‹ï¼‰\n    answer = answer.replace(\"check_passed\", \"\").strip()\n\n    return {\n        \"answer\": answer\n    }\n"
        code_language: python3
        isInIteration: false
        isInLoop: true
        loop_id: '1763368375230'
        outputs:
          answer:
            children: null
            type: string
        selected: true
        title: æ”¹å†™åansweræå–
        type: code
        variables:
        - value_selector:
          - '1763368578143'
          - text
          value_type: string
          variable: rewritten_response
      height: 52
      id: '1763368621379'
      parentId: '1763368375230'
      position:
        x: 1336
        y: 68
      positionAbsolute:
        x: 4043.5991667145195
        y: 388.2657294124139
      selected: true
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
      zIndex: 1002
    - data:
        isInIteration: false
        isInLoop: true
        items:
        - input_type: variable
          operation: over-write
          value:
          - '1763368621379'
          - answer
          variable_selector:
          - '1763368375230'
          - answer
          write_mode: over-write
        loop_id: '1763368375230'
        selected: false
        title: å˜é‡èµ‹å€¼
        type: assigner
        version: '2'
      height: 84
      id: '1763368644487'
      parentId: '1763368375230'
      position:
        x: 1638
        y: 68
      positionAbsolute:
        x: 4345.599166714519
        y: 388.2657294124139
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
      zIndex: 1002
    - data:
        context:
          enabled: false
          variable_selector: []
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: qwen3-vl-32b-thinking
          provider: langgenius/tongyi/tongyi
        prompt_template:
        - id: 04daa0c1-f340-4d91-9eb9-2649844480b1
          role: system
          text: "ä½ æ˜¯ä¸€åè´Ÿè´£â€œæ€ç»´é“¾ä¼˜åŒ–â€çš„åŠ©æ‰‹ã€‚\n\nç°åœ¨ç»™ä½ ï¼š\n- é—®é¢˜ï¼š{{#1763361675335.query#}}\n- é—®é¢˜æ¥æºæ–‡æœ¬ï¼š{{#1763361675335.source_chunk#}}\n- åŸå§‹ç­”æ¡ˆï¼š{{#1763368375230.answer#}}\n- åŸå§‹æ€ç»´é“¾ï¼š{{#1763368075740.cot#}}\n\nä½ çš„ä»»åŠ¡ï¼šåœ¨ä¸æ”¹å˜ç»“è®ºæ–¹å‘çš„å‰æä¸‹ï¼ŒåŸºäºé—®é¢˜ä¸ç›¸å…³æ–‡æœ¬ï¼Œæ”¹å†™å¹¶ä¼˜åŒ–è¿™æ¡æ€ç»´é“¾ï¼Œä½¿å…¶æ›´æ¸…æ™°ã€é€»è¾‘æ›´ä¸¥è°¨ï¼Œå¯ä½œä¸ºè®­ç»ƒç”¨çš„æ¨ç†è¿‡ç¨‹ã€‚\n\nè¯·ä¸¥æ ¼éµå®ˆä»¥ä¸‹è¦æ±‚ï¼š\n1. åªè¾“å‡ºä¼˜åŒ–åçš„æ€ç»´é“¾ï¼Œä¸è¦è¾“å‡ºç­”æ¡ˆæœ¬èº«ï¼Œä¹Ÿä¸è¦è§£é‡Šä½ åœ¨åšä»€ä¹ˆã€‚\n2. æ€ç»´é“¾å¿…é¡»å›´ç»•ä¸Šè¿°â€œé—®é¢˜â€å±•å¼€ï¼Œæ­¥éª¤æ¸…æ™°ã€æœ‰å› æœ‰æœï¼Œèƒ½åˆç†æ¨å¯¼å‡ºåŸå§‹ç­”æ¡ˆã€‚\n3. ä¸è¦å‡ºç°ä¸‹åˆ—å†…å®¹ï¼š\n   - â€œä¼˜åŒ–åçš„æ€ç»´é“¾â€â€œå¦‚ä¸‹æ‰€ç¤ºâ€â€œæ ¹æ®ä¸Šæ–‡/åŸæ–‡/ç‰‡æ®µâ€ç­‰å…ƒæè¿°ï¼›\n   - å¯¹æœªæ¥æ¨¡å‹çš„æŒ‡å¯¼è¯­ï¼ˆå¦‚â€œæ¨¡å‹åº”è¯¥å…ˆåšä»€ä¹ˆå†åšä»€ä¹ˆâ€ï¼‰ï¼›\n   - ä»»ä½•æ§åˆ¶æ ‡è®°ï¼Œå¦‚ `check_passed`ã€`check_failed` ç­‰ï¼›\n   - Markdown è¯­æ³•ç»“æ„ï¼ˆæ ‡é¢˜ã€åˆ—è¡¨ç¬¦å·ç­‰ï¼‰ï¼Œåªç”¨è‡ªç„¶æ®µæˆ–ç®€å•ç¼–å·è¯´æ˜ã€‚\n4. å¦‚éœ€å¼•ç”¨é—®é¢˜æ¥æºæ–‡æœ¬ä¸­çš„ä¿¡æ¯ï¼Œè¯·ç›´æ¥ç”¨è‡ªç„¶è¯­è¨€æè¿°ï¼Œä¸è¦å†™æˆâ€œåœ¨æ–‡æœ¬ä¸­æåˆ°â€¦â€¦â€ã€‚\n\nè¯·ç›´æ¥è¾“å‡ºä¸€æ®µè¿ç»­ã€è‡ªç„¶çš„æ€ç»´é“¾æ–‡æœ¬ã€‚\n"
        selected: false
        title: COTæ”¹å†™
        type: llm
        vision:
          enabled: false
      height: 88
      id: '1763368671011'
      position:
        x: 4691.789047229225
        y: 320.2657294124139
      positionAbsolute:
        x: 4691.789047229225
        y: 320.2657294124139
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        code: "def main(rewritten_cot: str, answer: str) -> dict:\n    \"\"\"\n    è¾“å…¥ï¼š\n        rewritten_cot: CoT æ”¹å†™èŠ‚ç‚¹çš„è¾“å‡ºï¼ˆå¯èƒ½åŒ…å«æˆ–ä¸åŒ…å« <think> æ ‡ç­¾ï¼‰\n        answer: æœ€ç»ˆè¦ä¿ç•™çš„å›ç­”å†…å®¹\n    è¾“å‡ºï¼š\n        combine_answer: æŒ‰ <think>æ€ç»´é“¾</think> + å›ç­” ç»„åˆåçš„æ•´ä½“ç»“æœ\n    \"\"\"\n    if rewritten_cot is None:\n        rewritten_cot = \"\"\n    if answer is None:\n        answer = \"\"\n\n    cot_text = rewritten_cot.strip()\n\n    # å¦‚æœæ¨¡å‹åˆè‡ªå·±åŒ…äº†ä¸€å±‚ <think>...</think>ï¼Œå…ˆæŠŠå†…éƒ¨å†…å®¹å–å‡ºæ¥\n    if \"<think>\" in cot_text and \"</think>\" in cot_text:\n        start_index = cot_text.find(\"<think>\") + len(\"<think>\")\n        end_index = cot_text.find(\"</think>\", start_index)\n        if end_index != -1:\n            cot_text = cot_text[start_index:end_index].strip()\n\n    # å†ä¿é™©ä¸€æ¬¡ï¼šå»æ‰å¯èƒ½æ®‹ç•™çš„æ ‡ç­¾\n    cot_text = cot_text.replace(\"<think>\", \"\").replace(\"</think>\", \"\").strip()\n\n    # ç»„åˆæˆå¸¦æ€ç»´é“¾çš„å®Œæ•´è¾“å‡º\n    combined = f\"<think>{cot_text}</think>\\n{answer.strip()}\"\n\n    return {\n        \"combine_answer\": combined\n    }\n"
        code_language: python3
        outputs:
          combine_answer:
            children: null
            type: string
        selected: false
        title: æ”¹å†™åCOTæå–RESULT
        type: code
        variables:
        - value_selector:
          - '1763368671011'
          - text
          value_type: string
          variable: rewritten_cot
        - value_selector:
          - '1763368375230'
          - answer
          value_type: string
          variable: answer
      height: 52
      id: '1763368685028'
      position:
        x: 4968.831808846315
        y: 320.2657294124139
      positionAbsolute:
        x: 4968.831808846315
        y: 320.2657294124139
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        outputs:
        - value_selector:
          - '1763368685028'
          - combine_answer
          value_type: string
          variable: text
        - value_selector:
          - '1763365957228'
          - is_valid
          value_type: string
          variable: query_is_valid
        - value_selector:
          - '1763368075740'
          - cot
          value_type: string
          variable: first_rag_answer
        - value_selector:
          - '1763366129870'
          - result
          value_type: array[object]
          variable: distill_rag
        - value_selector:
          - '1763366107839'
          - class_name
          value_type: string
          variable: query_class_name
        selected: false
        title: æ”¹å†™ç»“æœ
        type: end
      height: 192
      id: '1763368706643'
      position:
        x: 5245.683995581579
        y: 320.2657294124139
      positionAbsolute:
        x: 5245.683995581579
        y: 320.2657294124139
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    viewport:
      x: -2689.2353238231294
      y: -18.406250157818818
      zoom: 0.8705505632961257
  rag_pipeline_variables: []
